{% extends "master.html" %}
{% load static %}
{% load urlify %}
{% load humanize %}

{% block title %}Vehicle Used For{% endblock %}

{% block PluginsCSS %}
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/jquery.dataTables.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/select.bootstrap5.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/sweetalert2.css" %}">
{% endblock %}

{% block breadcrumb %}
    <div class="container-fluid">
        <div class="page-title">
            <div class="row">
                <div class="col-sm-6">
                    <h3>Vehicle Used For Manage System</h3>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="index">
                                <svg class="stroke-icon">
                                    <use href="{% static 'assets/svg/icon-sprite.svg' %}#stroke-home"></use>
                                </svg>
                            </a>
                        </li>
                        <li class="breadcrumb-item">Vehicle</li>
                        <li class="breadcrumb-item active">Used - (PITB)</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block content %}

    <!-- Container-fluid starts-->
    <div class="container-fluid">

        <div class="row">

            <div class="col-sm-12">
                <div class="common-f-start justify-content-md-end mb-3">
                    <div class="btn-group btn-group-action">
                        <button class="btn btn-primary btn-md" onclick="Cred_VehicleUsedFor_ShowModel('NEW');">
                            <i class="fa fa-plus"></i> Add New Vehicle Types
                            <span class="loading-spinner" id="loadingSpinner"></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row user-list-wrapper">
            <div class="col-12">

                <div class="card">
                    <style>
                        .user-list-wrapper .user-list-table div.dt-container .dt-layout-row .dt-search {
                            right: 20px;
                        }
                    </style>
                    <div class="card-header card-no-border text-end pb-5"></div>
                    <div class="card-body pt-0 px-0">
                        <div class="list-product user-list-table recent-table task-table">
                            <div class="table-responsive custom-scrollbar ">
                                <table class="table" id="container-list">
                                    <thead>
                                    <tr>
                                        <th>#</th>
                                        <th><span class="c-o-light f-w-600">Name</span></th>
                                        <th><span class="c-o-light f-w-600">Description</span></th>
                                        <th><span class="c-o-light f-w-600">Status</span></th>
                                        <th><span class="c-o-light f-w-600">Actions</span></th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for rec in data %}
                                        <tr class="product-removes inbox-data">
                                            <td>{{ forloop.counter }}</td>
                                            <td><a href="javaScript:void(0)">{{ rec.vehicle_use_name }}</a></td>
                                            <td><p>{{ rec.description }}</p></td>
                                            <td>
                                                {% if rec.status == 'Active' %}
                                                    <span class="badge bg-success">Active</span>
                                                {% else %}
                                                    <span class="badge bg-danger">Blocked</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                <div class="common-align gap-2 justify-content-start">
                                                    <a class="square-white" href="javaScript:void(0)"
                                                       onclick="Cred_VehicleUsedFor_ShowModel('UPDATE,{{ rec.id }},{{ rec.vehicle_use_name }},{{ rec.status }},{{ rec.description }}');">
                                                        <svg>
                                                            <use href="{% static 'assets/svg/icon-sprite.svg' %}#edit-content"></use>
                                                        </svg>
                                                    </a>
                                                    <a class="square-white trash-8" href="javaScript:void(0)"
                                                       onclick="Cred_VehicleUsedFor_ShowModel('DELETED,{{ rec.id }}');">
                                                        <svg>
                                                            <use href="{% static 'assets/svg/icon-sprite.svg' %}#trash1"></use>
                                                        </svg>
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

{% endblock %}

{% block PluginsJS %}

    <script src="{% static "assets/js/datatable/datatables/jquery.dataTables.min.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatables/dataTables.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatables/dataTables.select.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatables/select.bootstrap5.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatables/datatable.custom.js" %}"></script>
    <script src="{% static "assets/js/sweet-alert/sweetalert.min.js" %}"></script>
    <script src="{% static "assets/js/trash_popup.js" %}"></script>
    <script src="{% static "assets/js/common-check.js" %}"></script>

{% endblock %}

{% block CustomerJS %}
    <script>

        $(document).ready(function () {

            {% if messages %}
                {% for message in messages %}
                    UtilityModelJS.ToastSweetAlert("top-center", "success", "{{ message }}");
                {% endfor %}
            {% endif %}

        });

        function Cred_VehicleUsedFor_ShowModel(params) {

            var split = params.split(",");

            let action_type = split[0];
            let unique_id = "";
            let set_name = "";
            let set_status = "Active";
            let set_description = "";
            if (action_type === "UPDATE") {
                unique_id = split[1];
                set_name = split[2];
                set_status = split[3];
                set_description = split[4];
            } else if (action_type === "DELETED") {
                unique_id = split[1];

                const deleteIcons = document.querySelectorAll(".trash-8");
                deleteIcons.forEach(function (icon) {
                    icon.addEventListener("click", function (event) {
                        event.preventDefault();
                        let alertMessage = "Do you really want to delete this item?";

                        Swal.fire({
                            title: "Are you sure?",
                            text: alertMessage,
                            showCancelButton: true,
                            confirmButtonColor: "#16C7F9",
                            cancelButtonColor: "#FC4438",
                            confirmButtonText: "Yes, delete it!",
                            imageUrl: "/static/assets/images/gif/trash.gif",
                            imageWidth: 120,
                            imageHeight: 120,
                        }).then((result) => {
                            if (result.isConfirmed) {
                                $("#vehicleUsedForm").submit(); // manually submit form
                            }
                        });
                    });
                });

            }

            $("#effect-modal-header").empty();
            $("#effect-modal-header").append('<h6 class="modal-title text-capitalize" id="set_title">Add-on New Vehicle Used for PITB</h6>' +
                '<button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button">' +
                '<span aria-hidden="true">Ã—</span></button>');

            $("#effect-modal-body").html("");
            var container_body = $("#effect-modal-body");
            container_body.append('<form id="vehicleUsedForm" method="post" action="">' +   // action="" means same URL
                '{% csrf_token %}' +
                '<div class="row g-3 p-3 mb-3">' +
                "<input type='hidden' id='action_type' name='action_type' value='" + action_type + "' autocomplete='off'>" +
                "<input type='hidden' id='unique_id' name='unique_id' value='" + unique_id + "' autocomplete='off'>" +
                '<div class="col-12">' +
                '<label for="create_name" class="form-label">Vehicle Use Name</label>' +
                "<input type='text' name='vehicle_use_name' id='vehicle_use_name' value='" + set_name + "' class='form-control' placeholder='Enter name' required ></div>" +
                '<div class="col-12">' +
                '<label for="cmd_status" class="form-label">Status</label>' +
                '<select name="cmd_status" id="cmd_status" class="form-select">' +
                '<option value="Active">Active</option>' +
                '<option value="Block">Block</option>' +
                '</select></div>' +
                '<div class="col-12">' +
                '<label for="create_description" class="form-label">Description</label>' +
                "<input type='text' name='description' id='description' value='" + set_description + "' class='form-control' placeholder='Enter description' ></div>" +
                '</div>' +
                '</form>'
            );

            //// Now set value dynamically
            $("#cmd_status").val(set_status);   // e.g., from your data
            $("#cmd_status").trigger("change");

            $("#effect-modal-footer").html("");
            var container_footer = $("#effect-modal-footer");
            container_footer.append('<button class="btn btn-sm w-50 btn-success" type="button" id="submitBtn">Save Used For</button>' +
                '<button class="btn btn-sm w-25 btn-danger" data-bs-dismiss="modal" type="button">Close</button>');

            if (action_type !== "DELETED") {
                $('#effectModal').modal('show');
            }

            //// FORM VALIDATION (START)
            $("#submitBtn").click(function () {
                let Status = 0;

                if (Status === 0) {
                    $("#vehicleUsedForm").submit(); // Submit the form
                }
            });
            //// FORM VALIDATION (END)

        }

    </script>
{% endblock %}