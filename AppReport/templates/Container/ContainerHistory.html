{% extends "master.html" %}
{% load static %}

{% block title %}Container{% endblock %}

<!-- Custom Plugins CSS -->
{% block PluginsCSS %}
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/jquery.dataTables.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/select.bootstrap5.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/autoFill.bootstrap5.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/keyTable.bootstrap5.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/buttons.bootstrap5.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/fixedHeader.bootstrap5.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/responsive.bootstrap5.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/rowReorder.bootstrap5.css" %}">
{% endblock %}
<!--End Custom Plugins CSS -->

{% block LeafletLink %}
    <!--Google Key-->
    <script type="text/javascript"
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDyN4NVgaHV6-AbuAdWqSBM07iay6gbfKc&libraries=places"></script>

    <!--leaflet js library style link -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
          integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
          crossorigin=""/>
    <link rel="stylesheet"
          href="{% static 'assets/script/jslib/leaflet/plugins/PolylineMeasure/Leaflet.PolylineMeasure.css' %}"/>
    <link rel="stylesheet"
          href="{% static 'assets/script/jslib/leaflet/plugins/styledLayerControl/styledLayerControl.css' %}"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"/>
{% endblock %}

{% block css %}

    .default-map-js-height{
    {#    height: 605px;#}
    height: 100vh;
    }

{% endblock %}

<!-- Header Page Hierarchy-->
{% block breadcrumb %}
    <div class="container-fluid">
        <div class="page-title">
            <div class="row">
                <div class="col-sm-6">
                    {#        <h3>{{breadcrumb.title}} </h3>#}
                    <h3>Container History Report</h3>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/index">
                            <svg class="stroke-icon">
                                <use href="{% static 'assets/svg/icon-sprite.svg' %}#stroke-home"></use>
                            </svg>
                        </a></li>
                        {#          <li class="breadcrumb-item">{{breadcrumb.parent}}</li>#}
                        <li class="breadcrumb-item">Report</li>
                        <li class="breadcrumb-item">Container</li>
                        <li class="breadcrumb-item active">History</li>
                        {#          <li class="breadcrumb-item active">{{breadcrumb.child}}</li>#}
                    </ol>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
<!-- Header Page Hierarchy-->

{% block content %}

    <!-- Container-fluid starts-->
    <div class="container-fluid main-tasks">

        <div class="row">

            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <div class="row g-3 custom-input">
                            <div class="col-xl col-md-6">
                                <label class="form-label">Town Name</label>
                                <select id="cmd_town" name="cmd_town" class="form-select">
                                    <option Value="NA">Choose One</option>
                                    {% for town in town_boundary %}
                                        <option value="{{ town.town_code }}">
                                            {{ town.town_name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-xl col-md-6">
                                <label class="form-label">Zone Name</label>
                                <select class="form-select" id="cmd_zone" name="cmd_zone">
                                    <option value="NA">Select</option>
                                </select>
                            </div>
                            <div class="col-xl col-md-6">
                                <label class="form-label">MC Name</label>
                                <select class="form-select" id="cmd_mc" name="cmd_mc">
                                    <option value="NA">Select</option>
                                </select>
                            </div>
                            <div class="col-xl col-md-6">
                                <label class="form-label">Vehicle With Type</label>
                                <select class="form-select" id="cmd_mddc" name="cmd_mddc">
                                    <option value="NA">Select</option>
                                </select>
                            </div>
                            <div class="col-xl col-md-6">
                                <label class="form-label">Duration</label>
                                <select class="form-select" id="cmd_mddc" name="cmd_mddc">
                                    <option value="NA">Select</option>
                                </select>
                            </div>
                            <div class="col-xl col-md-6">
                                <label class="form-label">Container With Type</label>
                                <select class="form-select" id="cmd_mddc" name="cmd_mddc">
                                    <option value="NA">Select</option>
                                </select>
                            </div>
                            <div class="col d-flex justify-content-start align-items-center m-t-40">
                                <a class="btn btn-primary f-w-500" href="#!">Submit</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div class="row">
            <div class="col-sm-12 col-xl-4 box-col-4">
                <div class="card">
                    <div class="card-header">
                        <h5>Complete Container Details </h5>
                    </div>
                    <div class="card-body">
                        <div id="CompleteContainerDetailGraph" style="min-height: 365px;">
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-12 col-xl-8 box-col-8">
                <div class="card">
                    <div class="card-header">
                        <h5>Town Wise Details </h5>
                    </div>
                    <div class="card-body">
                        <div id="TownWiseDetailGraph" style="min-height: 365px;">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row subscribed-user">
            <div class="col-sm-12">
                <div class="card">
                    <div class="card-header card-no-border">
                        <div class="header-top">
                            <h5>Container History Report</h5>
                        </div>
                    </div>
                    <div class="card-body pt-0 px-0">
                        <div class="row">
                            <div class="col-12">
                                <div class="subscribed-user-wrapper">
                                    <div class="recent-table table-responsive custom-scrollbar">
                                        <table class="table" id="container-history-report">
                                            <thead>
                                            <tr>
                                                <th>SL</th>
                                                <th><span class="c-o-light f-w-600">Town</span></th>
                                                <th><span class="c-o-light f-w-600">Container Name</span></th>
                                                <th><span class="c-o-light f-w-600">Visited Vehicle</span></th>
                                                <th><span class="c-o-light f-w-600">DateTime</span></th>
                                                <th><span class="c-o-light f-w-600">Status</span></th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for data in container_process_data %}
                                                <tr class="inbox-data">
                                                    <th scope="row"
                                                        class="xsm-text text-capitalize align-middle">
                                                        {{ forloop.counter }}
                                                    </th>
                                                    <td>
                                                        <p><b>{{ data.container_name }}</b></p>
                                                    </td>
                                                    <td>
                                                        <div class="d-flex">
                                                            <div class="d-flex align-items-center gap-2 justify-content-center">
                                                                <div>
                                                                    <a class="pb-1"
                                                                       href="javaScript:void(0)">
                                                                        Town Name: Ali Town
                                                                    </a>
                                                                    <ul class="task-icons">
                                                                        <li><span
                                                                                class="text-muted">Zone: Ali Town</span>
                                                                        </li>
                                                                        <li class="f-light flex-wrap">
                                                                            <span>UC : Ali Town </span>
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="d-flex">
                                                            <div class="d-flex align-items-center gap-2 justify-content-center">
                                                                <div>
                                                                    <a class="pb-1"
                                                                       href="javaScript:void(0)">
                                                                        Vehicle: {{ data.register_no }}
                                                                    </a>
                                                                    <ul class="task-icons">
                                                                        <li><span
                                                                                class="text-muted">Type: {{ data.vehicle_type }}</span>
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="d-flex">
                                                            <div class="d-flex align-items-center gap-2 justify-content-center">
                                                                <div>
                                                                    <a class="pb-1"
                                                                       href="javaScript:void(0)">
                                                                        Total Time: {{ data.net_time_spent }}
                                                                    </a>
                                                                    <ul class="task-icons">
                                                                        <li><span
                                                                                class="text-muted">Duration: {{ data.check_in }} - {{ data.check_out }} </span>
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <p><b>{{ data.cont_proc_type_name }}</b></p>
                                                    </td>
                                                </tr>

                                            {% endfor %}
                                            {#                                            <tr class="inbox-data">#}
                                            {#                                                <td></td>#}
                                            {#                                                <td><a href="#!">keegan@gmail.com</a></td>#}
                                            {#                                                <td>#}
                                            {#                                                    <p class="c-o-light">02 Feb 2024 03:21:45 AM</p>#}
                                            {#                                                </td>#}
                                            {#                                                <td><span class="badge badge-light-success">Subscribe</span></td>#}
                                            {#                                                <td><a class="square-white" href="#!" data-bs-toggle="tooltip"#}
                                            {#                                                       data-bs-placement="top" data-bs-title="Change Status"><i#}
                                            {#                                                        class="fa-solid fa-arrows-rotate"></i></a></td>#}
                                            {#                                            </tr>#}
                                            {#                                            <tr class="inbox-data">#}
                                            {#                                                <td></td>#}
                                            {#                                                <td><a href="#!">creed@gmail.com</a></td>#}
                                            {#                                                <td>#}
                                            {#                                                    <p class="c-o-light">11 Mar 2024 02:23:12 PM</p>#}
                                            {#                                                </td>#}
                                            {#                                                <td><span class="badge badge-light-danger">Unsubscribe</span></td>#}
                                            {#                                                <td><a class="square-white" href="#!" data-bs-toggle="tooltip"#}
                                            {#                                                       data-bs-placement="top" data-bs-title="Change Status"><i#}
                                            {#                                                        class="fa-solid fa-arrows-rotate"></i></a></td>#}
                                            {#                                            </tr>#}

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <!-- Container-fluid Ends-->

{% endblock %}

<!-- Plugins JS start-->
{% block PluginsJS %}

    <script src="{% static "assets/js/datatable/datatables/jquery.dataTables.min.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatables/dataTables.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatables/dataTables.select.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatables/select.bootstrap5.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatables/datatable.custom.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/dataTables.autoFill.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/autoFill.bootstrap5.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/dataTables.keyTable.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/keyTable.bootstrap5.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/dataTables.buttons.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/buttons.bootstrap5.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/buttons.colVis.min.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/dataTables.fixedHeader.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/fixedHeader.bootstrap5.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/jszip.min.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/pdfmake.min.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/vfs_fonts.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/buttons.html5.min.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/buttons.print.min.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/dataTables.responsive.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/responsive.bootstrap5.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/dataTables.rowReorder.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/rowReorder.bootstrap5.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/custom.js" %}"></script>

    <script src="{% static "assets/js/flat-pickr/flatpickr.js" %}"></script>
    <script src="{% static "assets/js/flat-pickr/custom-flatpickr.js" %}"></script>
    <script src="{% static "assets/js/select/bootstrap-select.min.js" %}"></script>
    <script src="{% static "assets/js/tooltip-init.js" %}"></script>

    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    <script src="https://code.highcharts.com/modules/drilldown.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>

{% endblock %}
<!-- Plugins JS Ends-->

{% block LeafletJS %}
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
            integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
            crossorigin=""></script>
    <script src="{% static 'assets/script/jslib/leaflet/plugins/GoogleMutant/Leaflet.GoogleMutant.js' %}"></script>
    <script src="{% static 'assets/script/jslib/leaflet/plugins/measure/L.MeasuringTool.js' %}"></script>
    <script src="{% static 'assets/script/jslib/leaflet/plugins/PolylineMeasure/Leaflet.PolylineMeasure.js' %}"></script>
    <script src="{% static 'assets/script/jslib/leaflet/plugins/styledLayerControl/styledLayerControl.js' %}"></script>
    <!-- Dependency to Leaflet Draw -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <script src="https://npmcdn.com/leaflet.path.drag/src/Path.Drag.js"></script>
    <script src="{% static "assets/script/jslib/leaflet/plugins/Editable/Leaflet.Editable.js" %}"></script>
    <script src="{% static "assets/script/jslib/leaflet/plugins/Snap/leaflet.geometryutil.js" %}"></script>
    <script src="{% static "assets/script/jslib/leaflet/plugins/Snap/leaflet.snap.js" %}"></script>

    <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>

{% endblock %}

<!-- Custom JS -->
{% block CustomerJS %}
    <script src="{% static "assets/script/include/DigitalArz.js" %}" type="text/javascript"></script>
    <script src="{% static "assets/script/include/TOCLayerModel.js" %}" type="text/javascript"></script>
    <script src="{% static "js/ContainerModel.js" %}" type="text/javascript"></script>
    <script>

        let DigitalArzModelJS = null;
        let TOCLayerModelJS = null;
        let ContainerModelJS = null;

        {#let feature_lists_str = JSON.stringify({{ feature_lists | safe }});#}
        {#let feature_lists = JSON.parse(feature_lists_str);#}

        let complete_container_detail_str = JSON.stringify({{ complete_container_detail | safe }});
        let complete_container_detail = JSON.parse(complete_container_detail_str);

        let TownWiseDetail_str = JSON.stringify({{ TownWiseDetail | safe }});
        let TownWiseDetail = JSON.parse(TownWiseDetail_str);

        let town_names_str = JSON.stringify({{ town_names | safe }});
        let town_names = JSON.parse(town_names_str);

        $(document).ready(function () {

            ContainerModelJS = new AppContainerModel();
            ContainerModelJS.appConstructor();

            //// MAPPING MODEL JS
            {#DigitalArzModelJS = new AppDigitalArzModel("create-container-map");#}
            {#if (DigitalArzModelJS.map === null) {#}
            {#    DigitalArzModelJS.LoadMap("true", "");#}
            {#var district_extent = '72.29040124100004,31.214599082000063,72.40054018600006,31.319403121000054';#}
            {#////  THIS FUNCTION IS USED TO ZOOM THE LAYER  /////#}
            {#PMDFCModelJS.ZoomToFeature(district_extent);#}
            {##}
            {#    //// TOC LAYER MODEL LAYER DEFINE#}
            {#    TOCLayerModelJS = new AppTOCLayerModel();#}
            {#    TOCLayerModelJS.appConstructor();#}
            {##}
            {#    //// DISPLAY TOWN BOUNDARY ////#}
            {#    TOCLayerModelJS.DisplayTownBoundaryLayer();#}
            {##}
            {#    //// DISPLAY ZONE BOUNDARY ////#}
            {#    TOCLayerModelJS.DisplayZoneBoundaryLayer();#}
            {##}
            {#    //// DISPLAY UC BOUNDARY ////#}
            {#    TOCLayerModelJS.DisplayUCBoundaryLayer();#}
            {##}
            {#    //// THIS FUNCTION SHOW CONTAINER FEATURE ON MAP (CONDITION STATUS)#}
            {#    ContainerModelJS.ShowContainerFeatureMapBaseStatus(feature_lists);#}
            {##}
            {# }#}

            //// ONCHANGE FUNCTION THAT SHOW ZONE FROM THE SELECTED TOWN
            $("#cmd_town").change(function (e) {
                let selected_value = e.target.value;
                {#alert(selected_value);#}
                let condition_column = "zone_code=" + selected_value;
                let cmd_column = "zone_code^^zone_name";
                UtilityModelJS.FillCmdListByModelWithCode("tbl_zone_boundary", condition_column, cmd_column, "cmd_zone", "");
            });

            //// ONCHANGE FUNCTION THAT SHOW ZONE FROM THE SELECTED TOWN
            $("#cmd_zone").change(function (e) {
                let selected_value = e.target.value;
                {#alert(selected_value);#}
                let condition_column = "mc_code=" + selected_value;
                let cmd_column = "mc_code^^mc_name";
                UtilityModelJS.FillCmdListByModelWithCode("tbl_mc_boundary", condition_column, cmd_column, "cmd_mc", "");
            });

            CompleteContainerDetail('CompleteContainerDetailGraph', complete_container_detail);
            TownWiseDetailGraph('TownWiseDetailGraph', TownWiseDetail, town_names);


        }); //// DOCUMENT READY CLOSE

        function CompleteContainerDetail(id, complete_container_detail) {

            Highcharts.chart(id, {
                chart: {
                    type: 'column'
                },
                title: {
                    text: ''
                },

                legend: {
                    align: 'center',
                    verticalAlign: 'bottom',
                    layout: 'horizontal'
                },

                xAxis: {
                    categories: ['', ''],
                    labels: {
                        x: -10
                    }
                },

                yAxis: {
                    allowDecimals: false,
                    title: {
                        text: 'Containers'
                    }
                },

                plotOptions: {
                    series: {
                        borderWidth: 0,
                        dataLabels: {
                            enabled: true,
                            format: '{point.y:.0f}'
                        }
                    }
                },

                credits: {
                    enabled: false
                },

                series: complete_container_detail,

            });

        }

        function TownWiseDetailGraph(id, TownWiseDetail, town_names) {
            const chart = Highcharts.chart(id, {

                chart: {
                    type: 'column'
                },

                title: {
                    text: ''
                },

                legend: {
                    align: 'center',
                    verticalAlign: 'bottom',
                    layout: 'horizontal'
                },

                xAxis: {
                    categories: town_names,
                    labels: {
                        x: -10
                    }
                },

                yAxis: {
                    allowDecimals: false,
                    title: {
                        text: 'Containers'
                    }
                },

                credits: {
                    enabled: false
                },

                series: TownWiseDetail,

            });

        }

    </script>
{% endblock %}
<!-- End Custom JS -->