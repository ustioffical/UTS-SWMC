{% extends "master.html" %}
{% load static %}

{% block title %}Container{% endblock %}

<!-- Custom Plugins CSS -->
{% block PluginsCSS %}
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/jquery.dataTables.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/select.bootstrap5.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/autoFill.bootstrap5.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/keyTable.bootstrap5.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/buttons.bootstrap5.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/fixedHeader.bootstrap5.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/responsive.bootstrap5.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/rowReorder.bootstrap5.css" %}">
{% endblock %}
<!--End Custom Plugins CSS -->

{% block LeafletLink %}
    <!--Google Key-->
    <script type="text/javascript"
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDyN4NVgaHV6-AbuAdWqSBM07iay6gbfKc&libraries=places"></script>

    <!--leaflet js library style link -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
          integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
          crossorigin=""/>
    <link rel="stylesheet"
          href="{% static 'assets/script/jslib/leaflet/plugins/PolylineMeasure/Leaflet.PolylineMeasure.css' %}"/>
    <link rel="stylesheet"
          href="{% static 'assets/script/jslib/leaflet/plugins/styledLayerControl/styledLayerControl.css' %}"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"/>
{% endblock %}

{% block css %}

    .default-map-js-height{
    {#    height: 605px;#}
    height: 100vh;
    }

{% endblock %}

<!-- Header Page Hierarchy-->
{% block breadcrumb %}
    <div class="container-fluid">
        <div class="page-title">
            <div class="row">
                <div class="col-sm-6">
                    {#        <h3>{{breadcrumb.title}} </h3>#}
                    <h3>Container History Report</h3>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/index">
                            <svg class="stroke-icon">
                                <use href="{% static 'assets/svg/icon-sprite.svg' %}#stroke-home"></use>
                            </svg>
                        </a></li>
                        {#          <li class="breadcrumb-item">{{breadcrumb.parent}}</li>#}
                        <li class="breadcrumb-item">Report</li>
                        <li class="breadcrumb-item">Container</li>
                        <li class="breadcrumb-item active">History</li>
                        {#          <li class="breadcrumb-item active">{{breadcrumb.child}}</li>#}
                    </ol>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
<!-- Header Page Hierarchy-->

{% block content %}

    <!-- Container-fluid starts-->
    <div class="container-fluid main-tasks">

        <div class="row">

            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <div class="row g-3 custom-input">
                            <div class="col-xl col-md-6">
                                <label class="form-label">Town Name</label>
                                <select id="cmd_town" name="cmd_town" class="form-select">
                                    <option Value="NA">Choose One</option>
                                    {% for town in town_boundary %}
                                        <option value="{{ town.town_code }}">
                                            {{ town.town_name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-xl col-md-6">
                                <label class="form-label">Zone Name</label>
                                <select class="form-select" id="cmd_zone" name="cmd_zone">
                                    <option value="NA">Select</option>
                                </select>
                            </div>
                            <div class="col-xl col-md-6">
                                <label class="form-label">MC Name</label>
                                <select class="form-select" id="cmd_mc" name="cmd_mc">
                                    <option value="NA">Select</option>
                                </select>
                            </div>
                            <div class="col-xl col-md-6">
                                <label class="form-label">Vehicle With Type</label>
                                <select class="form-select" id="cmd_mddc" name="cmd_mddc">
                                    <option value="NA">Select</option>
                                </select>
                            </div>
                            <div class="col-xl col-md-6">
                                <label class="form-label">Duration</label>
                                <select class="form-select" id="cmd_mddc" name="cmd_mddc">
                                    <option value="NA">Select</option>
                                </select>
                            </div>
                            <div class="col-xl col-md-6">
                                <label class="form-label">Container With Type</label>
                                <select class="form-select" id="cmd_mddc" name="cmd_mddc">
                                    <option value="NA">Select</option>
                                </select>
                            </div>
                            <div class="col d-flex justify-content-start align-items-center m-t-40">
                                <a class="btn btn-primary f-w-500" href="#!">Submit</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div class="row candidate-wrapper">
            <div class="col-12">
                <div class="card">
                    <div class="card-body candidates-box px-0">
                        <div class="table-responsive custom-scrollbar">
                            <table class="table" id="vehicle-monitoring-table">
                                <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Vehicle</th>
                                    <th>System Hierarchy</th>
                                    <th>Location</th>
                                    <th>Device</th>
                                    <th>Action</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for data in vehicle_data_list %}
                                    <tr>
                                        <th scope="row"
                                            class="xsm-text text-capitalize align-middle">
                                            {{ forloop.counter }}
                                        </th>
                                        <td>
                                            <div class="common-flex align-items-center">
                                                <div class="position-relative">
                                                    <img class="img-fluid rounded-circle"
                                                         src="{% static 'assets/images/legend/vehicle/vehicle.png' %}"
                                                         alt="user">
                                                    <div class="status" style="width: 15px; height: 15px;">
                                                        <div class="inner-dot bg-{% if data.g_status == "Moving" %}success{% elif data.g_status == "Idle" %}info{% elif data.g_status == "Parked" %}warning{% elif data.g_status == "Offline" %}light{% else %}danger{% endif %}"></div>
                                                    </div>
                                                </div>
                                                <div><a class="f-w-500" href="#!">Register# {{ data.register_no }}</a>
                                                    <p>Chasis# {{ data.pitb_code }}</p>
                                                </div>
                                            </div>
                                            <div class="common-f-start">
                                                <div class="attachment">
                                                    <i class="fa-solid fa-car"></i>
                                                    <span>{{ data.vehicle_type }}</span>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <ul class="candidate-desc">
                                                <li>
                                                    <h6 class="c-light">Administrative: <span
                                                            class="f-14">UC/CC</span>
                                                    </h6>
                                                </li>
                                                <li>
                                                    <h6 class="c-light">Landuse: <span
                                                            class="f-14">Rural/Urban</span>
                                                    </h6>
                                                </li>
                                            </ul>
                                        </td>
                                        <td>
                                            <ul class="educations">
                                                <li>
                                                    <p class="mb-0">Location Time: {{ data.vendor_date_time }}</p>
                                                    <p class="mb-0">Location : {{ data.geo_location }}</p>
                                                </li>
                                            </ul>
                                        </td>
                                        <td>
                                            <ul class="candidate-skill">
                                                <li>
                                                    <p class="mb-2">Device Status :
                                                        <span>{{ data.device_status }}</span>
                                                    </p>
                                                </li>
                                                <li>
                                                    <div class="common-flex">
                                                        <span class="badge badge-light-primary">{{ data.ignition_status }}</span>
                                                        <span class="badge badge-light-warning">{{ data.g_status }}</span>
                                                        <span class="badge badge-light-success">{{ data.speed }}</span>
                                                        <span class="badge badge-light-secondary">{{ data.duration }}</span>
                                                    </div>
                                                </li>
                                            </ul>
                                        </td>
                                        <td>
                                            <div class="d-flex">
                                                <Button class="btn btn-primary" data-bs-toggle="tooltip"
                                                        data-bs-placement="top" data-bs-title="Message"
                                                        onclick="PITBApiModelJS.PushDataPITBServer_PostVTMSData()">
                                                    <i class="fa fa-paper-plane"></i>
                                                </Button>

                                                {#                                                <Button class="btn btn-success" data-bs-toggle="tooltip"#}
                                                {#                                                        data-bs-placement="top" data-bs-title="Approve"><i#}
                                                {#                                                        class="fa-solid fa-thumbs-up"></i></Button>#}
                                                {#                                                <Button class="btn btn-danger" data-bs-toggle="tooltip"#}
                                                {#                                                        data-bs-placement="top" data-bs-title="Reject"><i#}
                                                {#                                                        class="fa-solid fa-circle-xmark"></i></Button>#}
                                            </div>
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <!-- Container-fluid Ends-->

{% endblock %}

<!-- Plugins JS start-->
{% block PluginsJS %}

    <script src="{% static "assets/js/datatable/datatables/jquery.dataTables.min.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatables/dataTables.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatables/dataTables.select.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatables/select.bootstrap5.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatables/datatable.custom.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/dataTables.autoFill.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/autoFill.bootstrap5.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/dataTables.keyTable.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/keyTable.bootstrap5.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/dataTables.buttons.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/buttons.bootstrap5.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/buttons.colVis.min.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/dataTables.fixedHeader.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/fixedHeader.bootstrap5.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/jszip.min.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/pdfmake.min.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/vfs_fonts.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/buttons.html5.min.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/buttons.print.min.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/dataTables.responsive.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/responsive.bootstrap5.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/dataTables.rowReorder.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/rowReorder.bootstrap5.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatable-extension/custom.js" %}"></script>

    <script src="{% static "assets/js/flat-pickr/flatpickr.js" %}"></script>
    <script src="{% static "assets/js/flat-pickr/custom-flatpickr.js" %}"></script>
    <script src="{% static "assets/js/select/bootstrap-select.min.js" %}"></script>
    <script src="{% static "assets/js/tooltip-init.js" %}"></script>

    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    <script src="https://code.highcharts.com/modules/drilldown.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>

{% endblock %}
<!-- Plugins JS Ends-->

{% block LeafletJS %}
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
            integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
            crossorigin=""></script>
    <script src="{% static 'assets/script/jslib/leaflet/plugins/GoogleMutant/Leaflet.GoogleMutant.js' %}"></script>
    <script src="{% static 'assets/script/jslib/leaflet/plugins/measure/L.MeasuringTool.js' %}"></script>
    <script src="{% static 'assets/script/jslib/leaflet/plugins/PolylineMeasure/Leaflet.PolylineMeasure.js' %}"></script>
    <script src="{% static 'assets/script/jslib/leaflet/plugins/styledLayerControl/styledLayerControl.js' %}"></script>
    <!-- Dependency to Leaflet Draw -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <script src="https://npmcdn.com/leaflet.path.drag/src/Path.Drag.js"></script>
    <script src="{% static "assets/script/jslib/leaflet/plugins/Editable/Leaflet.Editable.js" %}"></script>
    <script src="{% static "assets/script/jslib/leaflet/plugins/Snap/leaflet.geometryutil.js" %}"></script>
    <script src="{% static "assets/script/jslib/leaflet/plugins/Snap/leaflet.snap.js" %}"></script>

    <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>

{% endblock %}

<!-- Custom JS -->
{% block CustomerJS %}
    <script src="{% static "assets/script/include/DigitalArz.js" %}" type="text/javascript"></script>
    <script src="{% static "assets/script/include/TOCLayerModel.js" %}" type="text/javascript"></script>
    {#    <script src="{% static "js/ContainerModel.js" %}" type="text/javascript"></script>#}
    <script src="{% static "assets/app_js/PITBApiModel.js" %}" type="text/javascript"></script>
    <script>

        let DigitalArzModelJS = null;
        let TOCLayerModelJS = null;
        let PITBApiModelJS = null;
        {#let ContainerModelJS = null;#}

        let push_pitb_server_post_vtms_data = '{% url "PushDataPITBServer_PostVTMSData" %}';

        {#let feature_lists_str = JSON.stringify({{ feature_lists | safe }});#}
        {#let feature_lists = JSON.parse(feature_lists_str);#}

        {#let complete_container_detail_str = JSON.stringify({{ complete_container_detail | safe }});#}
        {#let complete_container_detail = JSON.parse(complete_container_detail_str);#}
        {##}
        {#let TownWiseDetail_str = JSON.stringify({{ TownWiseDetail | safe }});#}
        {#let TownWiseDetail = JSON.parse(TownWiseDetail_str);#}
        {##}
        {#let town_names_str = JSON.stringify({{ town_names | safe }});#}
        {#let town_names = JSON.parse(town_names_str);#}

        $(document).ready(function () {

            PITBApiModelJS = new AppPITBApiModel();
            {#PITBApiModelJS.PushDataPITBServer_PostVTMSData();#}

            //// MAPPING MODEL JS
            {#DigitalArzModelJS = new AppDigitalArzModel("create-container-map");#}
            {#if (DigitalArzModelJS.map === null) {#}
            {#    DigitalArzModelJS.LoadMap("true", "");#}
            {#var district_extent = '72.29040124100004,31.214599082000063,72.40054018600006,31.319403121000054';#}
            {#////  THIS FUNCTION IS USED TO ZOOM THE LAYER  /////#}
            {#PMDFCModelJS.ZoomToFeature(district_extent);#}
            {##}
            {#    //// TOC LAYER MODEL LAYER DEFINE#}
            {#    TOCLayerModelJS = new AppTOCLayerModel();#}
            {#    TOCLayerModelJS.appConstructor();#}
            {##}
            {#    //// DISPLAY TOWN BOUNDARY ////#}
            {#    TOCLayerModelJS.DisplayTownBoundaryLayer();#}
            {##}
            {#    //// DISPLAY ZONE BOUNDARY ////#}
            {#    TOCLayerModelJS.DisplayZoneBoundaryLayer();#}
            {##}
            {#    //// DISPLAY UC BOUNDARY ////#}
            {#    TOCLayerModelJS.DisplayUCBoundaryLayer();#}
            {##}
            {#    //// THIS FUNCTION SHOW CONTAINER FEATURE ON MAP (CONDITION STATUS)#}
            {#    ContainerModelJS.ShowContainerFeatureMapBaseStatus(feature_lists);#}
            {##}
            {# }#}

            //// ONCHANGE FUNCTION THAT SHOW ZONE FROM THE SELECTED TOWN
            $("#cmd_town").change(function (e) {
                let selected_value = e.target.value;
                {#alert(selected_value);#}
                let condition_column = "zone_code=" + selected_value;
                let cmd_column = "zone_code^^zone_name";
                UtilityModelJS.FillCmdListByModelWithCode("tbl_zone_boundary", condition_column, cmd_column, "cmd_zone", "");
            });

            //// ONCHANGE FUNCTION THAT SHOW ZONE FROM THE SELECTED TOWN
            $("#cmd_zone").change(function (e) {
                let selected_value = e.target.value;
                {#alert(selected_value);#}
                let condition_column = "mc_code=" + selected_value;
                let cmd_column = "mc_code^^mc_name";
                UtilityModelJS.FillCmdListByModelWithCode("tbl_mc_boundary", condition_column, cmd_column, "cmd_mc", "");
            });


        }); //// DOCUMENT READY CLOSE


    </script>
{% endblock %}
<!-- End Custom JS -->