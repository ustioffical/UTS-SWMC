{% extends "master.html" %}
{% load static %}

{% block title %}Network{% endblock %}

<!-- Custom Plugins CSS -->
{% block PluginsCSS %}
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/jquery.dataTables.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/select.bootstrap5.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/sweetalert2.css" %}">
    {#    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/select/bootstrap-select.min.css" %}">#}
{% endblock %}
<!--End Custom Plugins CSS -->

{% block LeafletLink %}
    <!--Google Key-->
    <script type="text/javascript"
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDyN4NVgaHV6-AbuAdWqSBM07iay6gbfKc&libraries=places"></script>

    <!--leaflet js library style link -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
          integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
          crossorigin=""/>
    <link rel="stylesheet"
          href="{% static 'assets/script/jslib/leaflet/plugins/PolylineMeasure/Leaflet.PolylineMeasure.css' %}"/>
    <link rel="stylesheet"
          href="{% static 'assets/script/jslib/leaflet/plugins/styledLayerControl/styledLayerControl.css' %}"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"/>
{% endblock %}

{% block css %}

    .default-map-js-height{
    height: 605px;
    }
    .filter-companies .accordion-item {
    border: 1px solid #e9edf1;
    }

{% endblock %}

<!-- Header Page Hierarchy-->
{% block breadcrumb %}
    <div class="container-fluid">
        <div class="page-title">
            <div class="row">
                <div class="col-sm-6">
                    {#        <h3>{{breadcrumb.title}} </h3>#}
                    <h3>Design Network</h3>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/index">
                            <svg class="stroke-icon">
                                <use href="{% static 'assets/svg/icon-sprite.svg' %}#stroke-home"></use>
                            </svg>
                        </a></li>
                        {#          <li class="breadcrumb-item">{{breadcrumb.parent}}</li>#}
                        <li class="breadcrumb-item">Network</li>
                        <li class="breadcrumb-item active">Design</li>
                        {#          <li class="breadcrumb-item active">{{breadcrumb.child}}</li>#}
                    </ol>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
<!-- Header Page Hierarchy-->

{% block content %}

    <!-- Container-fluid starts-->
    <div class="container-fluid main-companies">
        <div class="row">

            <!-- FILTER -->
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <div class="row g-3 custom-input">
                            <div class="col-xl col-md-6">
                                <label class="form-label">Town Name</label>
                                <select id="cmd_town" name="cmd_town" class="form-select">
                                    <option Value="NA">Choose One</option>
                                    {% for town in town_boundary %}
                                        <option value="{{ town.town_code }}">
                                            {{ town.town_name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-xl col-md-6">
                                <label class="form-label">Zone Name</label>
                                <select class="form-select" id="cmd_zone" name="cmd_zone">
                                    <option value="NA">Select</option>
                                </select>
                            </div>
                            <div class="col-xl col-md-6">
                                <label class="form-label">MC Name</label>
                                <select class="form-select" id="cmd_mc" name="cmd_mc">
                                    <option value="NA">Select</option>
                                </select>
                            </div>
                            <div class="col-xl col-md-6">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="cmd_mddc" name="cmd_mddc">
                                    <option value="NA">Select</option>
                                </select>
                            </div>
                            <div class="col d-flex justify-content-start align-items-center m-t-40">
                                <a class="btn btn-primary f-w-500" href="#!">Submit</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- FILTER -->

            <div class="col-xl-5 xl-6 box-col-12">
                <div class="md-sidebar"><a class="btn btn-primary email-aside-toggle md-sidebar-toggle">Filters</a>
                    <div class="md-sidebar-aside job-sidebar custom-scrollbar">
                        <div class="card">
                            <div class="card-header">
                                <h5>Network Creativity</h5>
                            </div>
                            <div class="card-body filter-companies">
                                <div class="accordion" id="accordionExample">

                                    <!-- LAYER INFORMATION -->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button"
                                                    data-bs-toggle="collapse"
                                                    data-bs-target="#collapseThree" aria-expanded="true"
                                                    aria-controls="collapseThree">
                                                Layer Information
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                     viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                     stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                                     class="feather feather-chevron-down svg-color">
                                                    <polyline points="6 9 12 15 18 9"></polyline>
                                                </svg>
                                            </button>
                                        </h2>
                                        <div class="accordion-collapse collapse" id="collapseThree" style="">
                                            <div class="accordion-body">

                                            </div>
                                        </div>
                                    </div>
                                    <!-- LAYER INFORMATION -->

                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button"
                                                    data-bs-toggle="collapse"
                                                    data-bs-target="#collapseFour" aria-expanded="true"
                                                    aria-controls="collapseFour">
                                                All Network
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                     viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                     stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                                     class="feather feather-chevron-down svg-color">
                                                    <polyline points="6 9 12 15 18 9"></polyline>
                                                </svg>
                                            </button>
                                        </h2>
                                        <div class="accordion-collapse collapse" id="collapseFour" style="">
                                            <div class="accordion-body">
                                                <div class="product-filter">
                                                    <div class="checkbox-animated mt-0">
                                                        <label class="d-block" for="chk-ani17">
                                                            <input class="checkbox_animated" id="chk-ani17"
                                                                   type="checkbox" data-original-title="" title="">0-50
                                                            Employees
                                                        </label>
                                                        <label class="d-block" for="chk-ani18">
                                                            <input class="checkbox_animated" id="chk-ani18"
                                                                   type="checkbox" data-original-title="" title="">51-200
                                                            Employees
                                                        </label>
                                                        <label class="d-block" for="chk-ani19">
                                                            <input class="checkbox_animated" id="chk-ani19"
                                                                   type="checkbox" data-original-title="" title="">201-500
                                                            Employees
                                                        </label>
                                                        <label class="d-block" for="chk-ani20">
                                                            <input class="checkbox_animated" id="chk-ani20"
                                                                   type="checkbox" data-original-title="" title="">501-1000
                                                            Employees
                                                        </label>
                                                        <label class="d-block" for="chk-ani21">
                                                            <input class="checkbox_animated" id="chk-ani21"
                                                                   type="checkbox" data-original-title="" title="">1000-5000
                                                            Employees
                                                        </label>
                                                        <label class="d-block" for="chk-ani22">
                                                            <input class="checkbox_animated" id="chk-ani22"
                                                                   type="checkbox" data-original-title="" title="">5001-10000
                                                            Employees
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- CREATE NETWORK -->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button" type="button"
                                                    data-bs-toggle="collapse" data-bs-target="#collapseOSM"
                                                    aria-expanded="false" aria-controls="collapseOSM">
                                                OSM Network
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                     viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                     stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                                     class="feather feather-chevron-down svg-color">
                                                    <polyline points="6 9 12 15 18 9"></polyline>
                                                </svg>
                                            </button>
                                        </h2>
                                        <div class="accordion-collapse" id="collapseOSM" style="">
                                            <div class="accordion-body">
                                                <div class="row">

                                                    <!-- OSM NETWORK -->
                                                    <div class="col-md-12 col-sm-12">
                                                        <div class="card compare-order mb-0"
                                                             style="border: 1px solid #e9edf1;">
                                                            <div class="card-header card-no-border">
                                                                <div class="header-top">
                                                                    <div class="d-flex">
                                                                        <div class="text-end icon-state">
                                                                            <label class="switch mb-0">
                                                                                <input type="checkbox"
                                                                                       id="ck-all-osm-network">
                                                                                <span class="switch-state bg-success"></span>
                                                                            </label>
                                                                        </div>
                                                                        <label class="col-form-label m-l-10 f-w-500 Font-size f-18">
                                                                            All-OSM Network
                                                                        </label>
                                                                    </div>
                                                                    <button class="btn btn-primary"
                                                                            onclick="RouteModelJS.FetchOSMRoadNetworkByFilter();">
                                                                        <i class="fa-solid fa-arrows-rotate me-1"></i>
                                                                        Sync OSM Network
                                                                    </button>
                                                                </div>
                                                            </div>
                                                            <div class="card-body pt-0"><span class="f-w-500 c-o-light">Total Road Network</span>
                                                                <h4 class="mb-2">
                                                                    <span class="counter" data-target="1398700">100/1000-KM</span>
                                                                </h4>
                                                                <div class="progress" role="progressbar"
                                                                     aria-label="Basic example" aria-valuenow="58"
                                                                     aria-valuemin="0" aria-valuemax="100">
                                                                    <div class="progress-bar bg-success"
                                                                         style="width: 58%"></div>
                                                                </div>
                                                                <span class="user-growth f-12 f-w-500">
                                                                    <i class="icon-arrow-down txt-success"></i>
                                                                    <span class="txt-success">01-01-2025</span>
                                                                </span>
                                                                <span class="user-text">last sync</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- OSM NETWORK -->

                                                    <!-- NETWORK DRAW BY HAND -->
                                                    <div class="card-body main-divider">
                                                        <div class="divider-body divider-body-1 divider-secondary">
                                                            <div class="divider-p-secondary">
                                                                <i class="fa-solid fa-leaf me-2 txt-success f-20"></i>
                                                                <span class="txt-secondary">Road Network Draw By Hand </span>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-xxl-12 col-md-12 box-col-12 ord-xl-x box-ord-10">
                                                        <div class="card" style="border: 1px solid #e9edf1;">
                                                            <div class="card-body main-title-box">
                                                                <div class="common-space gap-2">
                                                                    <h6 class="f-light">
                                                                        Click on Start Button
                                                                    </h6>
                                                                    <div class="e-common-button">
                                                                        <button class="btn btn-info">
                                                                            <i class="fa-solid fa-line-chart me-1"></i>
                                                                            Draw Road Shape
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        {#                                                        <div class="card dashboard-2"#}
                                                        {#                                                             style="border: 1px solid #e9edf1;">#}
                                                        {#                                                            <div class="card-header card-no-border">#}
                                                        {#                                                                <div class="header-top">#}
                                                        {#                                                                    <h5>Click on Start Button</h5>#}
                                                        {#                                                                    <button class="btn btn-info">#}
                                                        {#                                                                        <i class="fa-solid fa-arrows-rotate me-1"></i>#}
                                                        {#                                                                        Start#}
                                                        {#                                                                    </button>#}
                                                        {#                                                                </div>#}
                                                        {#                                                            </div>#}
                                                        {#                                                            <div class="card-body px-0 pt-0 treading-product">#}
                                                        {##}
                                                        {#                                                            </div>#}
                                                        {#                                                        </div>#}
                                                    </div>
                                                    <!-- NETWORK DRAW BY HAND -->

                                                    <!-- NETWORK DRAW BY HAND -->
                                                    <div class="card-body main-divider">
                                                        <div class="divider-body divider-body-1 divider-secondary">
                                                            <div class="divider-p-secondary">
                                                                <i class="fa-solid fa-leaf me-2 txt-success f-20"></i>
                                                                <span class="txt-secondary">Google Road Network</span>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-xxl-12 col-md-12 box-col-12 ord-xl-x box-ord-10">
                                                        <div class="card" style="border: 1px solid #e9edf1;">
                                                            <div class="card-body main-title-box">
                                                                <div class="common-space gap-2">
                                                                    <h6 class="f-light">
                                                                        Mark Start and End Location
                                                                    </h6>
                                                                    <div class="e-common-button">
                                                                        <button class="btn btn-info">
                                                                            <i class="fa-solid fa-line-chart me-1"></i>
                                                                            Draw Road Shape
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        {#                                                        <div class="card dashboard-2"#}
                                                        {#                                                             style="border: 1px solid #e9edf1;">#}
                                                        {#                                                            <div class="card-header card-no-border">#}
                                                        {#                                                                <div class="header-top">#}
                                                        {#                                                                    <h5>Click on Start Button</h5>#}
                                                        {#                                                                    <button class="btn btn-info">#}
                                                        {#                                                                        <i class="fa-solid fa-arrows-rotate me-1"></i>#}
                                                        {#                                                                        Start#}
                                                        {#                                                                    </button>#}
                                                        {#                                                                </div>#}
                                                        {#                                                            </div>#}
                                                        {#                                                            <div class="card-body px-0 pt-0 treading-product">#}
                                                        {##}
                                                        {#                                                            </div>#}
                                                        {#                                                        </div>#}
                                                    </div>
                                                    <!-- NETWORK DRAW BY HAND -->

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- CREATE NETWORK -->

                                    <!-- SELECTED PENDING NETWORK -->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button" type="button"
                                                    data-bs-toggle="collapse"
                                                    data-bs-target="#collapsePending" aria-expanded="true"
                                                    aria-controls="collapsePending">
                                                Pending Network
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                     viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                     stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                                     class="feather feather-chevron-down svg-color">
                                                    <polyline points="6 9 12 15 18 9"></polyline>
                                                </svg>
                                            </button>
                                        </h2>
                                        <div class="accordion-collapse" id="collapsePending" style="">
                                            <div class="accordion-body">
                                                <div class="row">
                                                    <div class="col-xxl-12 col-md-12 box-col-12 ord-xl-x box-ord-10">
                                                        <div class="card dashboard-2"
                                                             style="border: 1px solid #e9edf1;">
                                                            <div class="card-header card-no-border">
                                                                <h5>Selected Road Network</h5>
                                                            </div>
                                                            <div class="card-body px-0 pt-0 treading-product">

                                                                <div class="table-responsive recent-table transaction-table custom-scrollbar">
                                                                    <table class="table">
                                                                        <thead>
                                                                        <tr>
                                                                            <th>#</th>
                                                                            <th>Type</th>
                                                                            <th>Name</th>
                                                                            <th>Address</th>
                                                                            <th>Action</th>
                                                                        </tr>
                                                                        </thead>
                                                                        <tbody class="align-middle"
                                                                               id="tbody-create-network-item-table">
                                                                        </tbody>
                                                                    </table>
                                                                </div>

                                                            </div>
                                                            <div class="card-footer text-end">
                                                                <button class="btn btn-primary" type="submit">Save
                                                                    Save Network
                                                                </button>

                                                                <!-- STRING GENERATE FOR VIEW TO SAVING DATA -->
                                                                <input type="hidden" id="hid_unique_id"
                                                                       name="hid_unique_id" value="NA">
                                                                <input type="hidden" id="hid_type" name="hid_type"
                                                                       value="NA">
                                                                <input type="hidden" id="feature_coordinate"
                                                                       name="feature_coordinate" value="NA">
                                                                <input type="hidden" id="lattitude" name="lattitude"
                                                                       value="NA">
                                                                <input type="hidden" id="longitude" name="longitude"
                                                                       value="NA">
                                                                <input type="hidden" id="id_address" name="id_address"
                                                                       value="NA">

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- SELECTED PENDING NETWORK -->

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-7 xl-66 box-col-12">
                <div class="card">
                    <div class="card-header common-project-header common-space p-15">
                        <div class="common-space">
                            <div class="pe-sm-3">
                                <h5>Map</h5>
                            </div>
                        </div>
                    </div>
                    <div class="card-body z-1 p-0">
                        <div class="default-map-js-height b-r-10" id="create-container-map"></div>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <!-- Container-fluid Ends-->

{% endblock %}

<!-- Plugins JS start-->
{% block PluginsJS %}

    <script src="{% static "assets/js/datatable/datatables/jquery.dataTables.min.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatables/dataTables.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatables/dataTables.select.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatables/select.bootstrap5.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatables/datatable.custom.js" %}"></script>
    <script src="{% static "assets/js/sweet-alert/sweetalert.min.js" %}"></script>

    <script src="{% static "assets/js/flat-pickr/flatpickr.js" %}"></script>
    <script src="{% static "assets/js/flat-pickr/custom-flatpickr.js" %}"></script>
    <script src="{% static "assets/js/select/bootstrap-select.min.js" %}"></script>
    <script src="{% static "assets/js/tooltip-init.js" %}"></script>

{% endblock %}
<!-- Plugins JS Ends-->

{% block LeafletJS %}
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
            integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
            crossorigin=""></script>
    <script src="{% static 'assets/script/jslib/leaflet/plugins/GoogleMutant/Leaflet.GoogleMutant.js' %}"></script>
    <script src="{% static 'assets/script/jslib/leaflet/plugins/measure/L.MeasuringTool.js' %}"></script>
    <script src="{% static 'assets/script/jslib/leaflet/plugins/PolylineMeasure/Leaflet.PolylineMeasure.js' %}"></script>
    <script src="{% static 'assets/script/jslib/leaflet/plugins/styledLayerControl/styledLayerControl.js' %}"></script>
    <!-- Dependency to Leaflet Draw -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <script src="https://npmcdn.com/leaflet.path.drag/src/Path.Drag.js"></script>
    <script src="{% static "assets/script/jslib/leaflet/plugins/Editable/Leaflet.Editable.js" %}"></script>
    <script src="{% static "assets/script/jslib/leaflet/plugins/Snap/leaflet.geometryutil.js" %}"></script>
    <script src="{% static "assets/script/jslib/leaflet/plugins/Snap/leaflet.snap.js" %}"></script>

    <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>

{% endblock %}

<!-- Custom JS -->
{% block CustomerJS %}
    <script src="{% static "assets/script/include/DigitalArz.js" %}" type="text/javascript"></script>
    <script src="{% static "assets/script/include/TOCLayerModel.js" %}" type="text/javascript"></script>
    <script src="{% static "js/../../static/assets/app_js/RouteModel.js" %}" type="text/javascript"></script>
    <script>

        let DigitalArzModelJS = null;
        let TOCLayerModelJS = null;
        let RouteModelJS = null;

        let fetch_osm_network_by_filter = '{% url "FetchOSMRoadNetworkByFilter" %}';

        $(document).ready(function () {

            RouteModelJS = new AppRouteModel();
            RouteModelJS.appConstructor();

            //// MAPPING MODEL JS
            DigitalArzModelJS = new AppDigitalArzModel("create-container-map");
            if (DigitalArzModelJS.map === null) {
                DigitalArzModelJS.LoadMap("true", "");

                //// TOC LAYER MODEL LAYER DEFINE
                TOCLayerModelJS = new AppTOCLayerModel();
                TOCLayerModelJS.appConstructor();

                //// DISPLAY TOWN BOUNDARY ////
                TOCLayerModelJS.DisplayTownBoundaryLayer();

                //// DISPLAY ZONE BOUNDARY ////
                TOCLayerModelJS.DisplayZoneBoundaryLayer();

            }

            //// ONCHANGE FUNCTION THAT SHOW ZONE FROM THE SELECTED TOWN
            $("#cmd_town").change(function (e) {
                let selected_value = e.target.value;
                {#alert(selected_value);#}
                let condition_column = "zone_code=" + selected_value;
                let cmd_column = "zone_code^^zone_name";
                UtilityModelJS.FillCmdListByModelWithCode("tbl_zone_boundary", condition_column, cmd_column, "cmd_zone", "");
            });

            //// ONCHANGE FUNCTION THAT SHOW ZONE FROM THE SELECTED TOWN
            $("#cmd_zone").change(function (e) {
                let selected_value = e.target.value;
                {#alert(selected_value);#}
                let condition_column = "mc_code=" + selected_value;
                let cmd_column = "mc_code^^mc_name";
                UtilityModelJS.FillCmdListByModelWithCode("tbl_mc_boundary", condition_column, cmd_column, "cmd_mc", "");
            });

            $("#ck-all-osm-network").click(function () {
                if ($(this).is(":checked")) {
                    //// DISPLAY OSM Road Network ////
                    TOCLayerModelJS.DisplayOSMRoadNetworkLayer();
                } else {
                    if (TOCLayerModelJS.OSMRoadNetwork !== undefined) {
                        DigitalArzModelJS.map.removeLayer(TOCLayerModelJS.OSMRoadNetwork);
                    }
                }
            });

        }); //// DOCUMENT READY CLOSE

    </script>
{% endblock %}
<!-- End Custom JS -->