{% extends "master.html" %}
{% load static %}

{% block title %}Container{% endblock %}

<!-- Custom Plugins CSS -->
{% block PluginsCSS %}
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/jquery.dataTables.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/select.bootstrap5.css" %}">
    {#    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/flatpickr/flatpickr.min.css" %}">#}
    {#    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/select/bootstrap-select.min.css" %}">#}
{% endblock %}
<!--End Custom Plugins CSS -->

{% block LeafletLink %}
    <!--Google Key-->
    <script type="text/javascript"
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDyN4NVgaHV6-AbuAdWqSBM07iay6gbfKc&libraries=places"></script>

    <!--leaflet js library style link -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
          integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
          crossorigin=""/>
    <link rel="stylesheet"
          href="{% static 'assets/script/jslib/leaflet/plugins/PolylineMeasure/Leaflet.PolylineMeasure.css' %}"/>
    <link rel="stylesheet"
          href="{% static 'assets/script/jslib/leaflet/plugins/styledLayerControl/styledLayerControl.css' %}"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"/>
{% endblock %}

{% block css %}

    .default-map-js-height{
{#    height: 605px;#}
    height: 100vh;
    }

{% endblock %}

<!-- Header Page Hierarchy-->
{% block breadcrumb %}
    <div class="container-fluid">
        <div class="page-title">
            <div class="row">
                <div class="col-sm-6">
                    {#        <h3>{{breadcrumb.title}} </h3>#}
                    <h3>Container List</h3>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/index">
                            <svg class="stroke-icon">
                                <use href="{% static 'assets/svg/icon-sprite.svg' %}#stroke-home"></use>
                            </svg>
                        </a></li>
                        {#          <li class="breadcrumb-item">{{breadcrumb.parent}}</li>#}
                        <li class="breadcrumb-item">Asset</li>
                        <li class="breadcrumb-item">Container</li>
                        <li class="breadcrumb-item active">List</li>
                        {#          <li class="breadcrumb-item active">{{breadcrumb.child}}</li>#}
                    </ol>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
<!-- Header Page Hierarchy-->

{% block content %}

    <!-- Container-fluid starts-->
    <div class="container-fluid main-tasks">
        <div class="row">

            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <div class="row g-3 custom-input">
                            <div class="col-xl col-md-6">
                                <label class="form-label">Town Name</label>
                                <select id="cmd_town" name="cmd_town" class="form-select">
                                    <option Value="NA">Choose One</option>
                                    {% for town in town_boundary %}
                                        <option value="{{ town.town_code }}">
                                            {{ town.town_name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-xl col-md-6">
                                <label class="form-label">Zone Name</label>
                                <select class="form-select" id="cmd_zone" name="cmd_zone">
                                    <option value="NA">Select</option>
                                </select>
                            </div>
                            <div class="col-xl col-md-6">
                                <label class="form-label">MC Name</label>
                                <select class="form-select" id="cmd_mc" name="cmd_mc">
                                    <option value="NA">Select</option>
                                </select>
                            </div>
                            <div class="col-xl col-md-6">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="cmd_mddc" name="cmd_mddc">
                                    <option value="NA">Select</option>
                                </select>
                            </div>
                            <div class="col d-flex justify-content-start align-items-center m-t-40">
                                <a class="btn btn-primary f-w-500" href="#!">Submit</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-7 user-list-wrapper">
                <div class="card">
                    <style>
                        .user-list-wrapper .user-list-table div.dt-container .dt-layout-row .dt-search {
                            right: 20px;
                        }
                    </style>
                    <div class="card-header card-no-border text-end pb-5">
                    </div>
                    <div class="card-body pt-0 px-0">
                        <div class="list-product user-list-table recent-table task-table">
                            <div class="table-responsive custom-scrollbar ">
                                <table class="table" id="container-list">
                                    <thead>
                                    <tr>
                                        <th><span class="c-o-light f-w-600">#</span></th>
                                        <th><span class="c-o-light f-w-600">Created-at</span></th>
                                        <th><span class="c-o-light f-w-600">Name</span></th>
                                        <th><span class="c-o-light f-w-600">Hierarchy</span></th>
                                        <th><span class="c-o-light f-w-600">Status</span></th>
                                        <th><span class="c-o-light f-w-600">Address</span></th>
                                        <th><span class="c-o-light f-w-600">Actions</span></th>
                                    </tr>
                                    </thead>
                                    <tbody class="main-task-wrapper">

                                    {% for data in container_list %}

                                        <tr class="product-removes inbox-data">
                                            <th scope="row"
                                                class="xsm-text text-capitalize align-middle">
                                                {{ forloop.counter }}
                                            </th>
                                            <th scope="row"
                                                class="xsm-text text-capitalize align-middle">
                                                {{ data.created_at|date:"M d, Y" }}
                                            </th>
                                            <td>
                                                <div class="d-flex">
                                                    <div class="d-flex align-items-center gap-2 justify-content-center">
                                                        <div>
                                                            <a class="pb-1"
                                                               href="javaScript:void(0)">
                                                                {{ data.container_name }}
                                                            </a>
                                                            <ul class="task-icons">
                                                                <li><span
                                                                        class="text-muted">Code</span>
                                                                </li>
                                                                <li class="f-light flex-wrap">
                                                                    <span>{{ data.container_code }}</span>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <div class="d-flex">
                                                    <div class="d-flex align-items-center gap-2 justify-content-center">
                                                        <div>
                                                            <a class="pb-1"
                                                               href="javaScript:void(0)">
                                                                {{ data.mc_code.zone_code.town_code.town_name }}
                                                            </a>
                                                            <ul class="task-icons">
                                                                <li><span
                                                                        class="text-muted">{{ data.mc_code.zone_code.zone_name }}</span>
                                                                </li>
                                                                <li class="f-light flex-wrap">
                                                                    <span>{{ data.mc_code.mc_name }}</span>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <div class="d-flex">
                                                    <div class="d-flex align-items-center gap-2 justify-content-center">
                                                        <div>
                                                            <a class="pb-1"
                                                               href="javaScript:void(0)">
                                                                {{ data.size }}
                                                            </a>
                                                            <ul class="task-icons">
                                                                <li><span
                                                                        class="text-muted">{{ data.working_status }}</span>
                                                                </li>
                                                                <li class="f-light flex-wrap">
                                                                    <span>{{ data.status }}</span>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <p>{{ data.address }}</p>
                                            </td>
                                            <td>
                                                <div class="common-align gap-2 justify-content-start">
                                                    <a
                                                            class="square-white"
                                                            href="add-user.html">
                                                        <svg>
                                                            <use href="{% static 'assets/svg/icon-sprite.svg' %}#edit-content"></use>
                                                        </svg>
                                                    </a><a
                                                        class="square-white trash-7"
                                                        href="#!">
                                                    <svg>
                                                        <use href="{% static 'assets/svg/icon-sprite.svg' %}#trash1"></use>
                                                    </svg>
                                                </a></div>
                                            </td>
                                        </tr>

                                    {% endfor %}

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-5">
                <div class="card">
                    <div class="card-header common-project-header common-space p-15">
                        <div class="common-space">
                            <div class="pe-sm-3">
                                <h5>Map</h5>
                            </div>
                        </div>
                        <div class="common-align">
                            <a href="{% url 'CreateContainer' %}" class="btn btn-primary" target="_blank">
                                <i class="fa-solid fa-plus"></i> Mark Location
                            </a>
                        </div>
                    </div>
                    <div class="card-body z-1 p-0">
                        <div class="default-map-js-height b-r-10" id="create-container-map"></div>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <!-- Container-fluid Ends-->

{% endblock %}

<!-- Plugins JS start-->
{% block PluginsJS %}

    <script src="{% static "assets/js/datatable/datatables/jquery.dataTables.min.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatables/dataTables.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatables/dataTables.select.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatables/select.bootstrap5.js" %}"></script>
    <script src="{% static "assets/js/datatable/datatables/datatable.custom.js" %}"></script>

    <script src="{% static "assets/js/flat-pickr/flatpickr.js" %}"></script>
    <script src="{% static "assets/js/flat-pickr/custom-flatpickr.js" %}"></script>
    <script src="{% static "assets/js/select/bootstrap-select.min.js" %}"></script>
    <script src="{% static "assets/js/tooltip-init.js" %}"></script>

{% endblock %}
<!-- Plugins JS Ends-->

{% block LeafletJS %}
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
            integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
            crossorigin=""></script>
    <script src="{% static 'assets/script/jslib/leaflet/plugins/GoogleMutant/Leaflet.GoogleMutant.js' %}"></script>
    <script src="{% static 'assets/script/jslib/leaflet/plugins/measure/L.MeasuringTool.js' %}"></script>
    <script src="{% static 'assets/script/jslib/leaflet/plugins/PolylineMeasure/Leaflet.PolylineMeasure.js' %}"></script>
    <script src="{% static 'assets/script/jslib/leaflet/plugins/styledLayerControl/styledLayerControl.js' %}"></script>
    <!-- Dependency to Leaflet Draw -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <script src="https://npmcdn.com/leaflet.path.drag/src/Path.Drag.js"></script>
    <script src="{% static "assets/script/jslib/leaflet/plugins/Editable/Leaflet.Editable.js" %}"></script>
    <script src="{% static "assets/script/jslib/leaflet/plugins/Snap/leaflet.geometryutil.js" %}"></script>
    <script src="{% static "assets/script/jslib/leaflet/plugins/Snap/leaflet.snap.js" %}"></script>

    <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>

{% endblock %}

<!-- Custom JS -->
{% block CustomerJS %}
    <script src="{% static "assets/script/include/DigitalArz.js" %}" type="text/javascript"></script>
    <script src="{% static "assets/script/include/TOCLayerModel.js" %}" type="text/javascript"></script>
    <script src="{% static "js/ContainerModel.js" %}" type="text/javascript"></script>
    <script>

        let DigitalArzModelJS = null;
        let TOCLayerModelJS = null;
        let ContainerModelJS = null;

        let feature_lists_str = JSON.stringify({{ feature_lists | safe }});
        let feature_lists = JSON.parse(feature_lists_str);

        $(document).ready(function () {

            ContainerModelJS = new AppContainerModel();
            ContainerModelJS.appConstructor();

            //// MAPPING MODEL JS
            DigitalArzModelJS = new AppDigitalArzModel("create-container-map");
            if (DigitalArzModelJS.map === null) {
                DigitalArzModelJS.LoadMap("true", "");
                {#var district_extent = '72.29040124100004,31.214599082000063,72.40054018600006,31.319403121000054';#}
                {#////  THIS FUNCTION IS USED TO ZOOM THE LAYER  /////#}
                {#PMDFCModelJS.ZoomToFeature(district_extent);#}

                //// TOC LAYER MODEL LAYER DEFINE
                TOCLayerModelJS = new AppTOCLayerModel();
                TOCLayerModelJS.appConstructor();

                //// DISPLAY TOWN BOUNDARY ////
                TOCLayerModelJS.DisplayTownBoundaryLayer();

                //// DISPLAY ZONE BOUNDARY ////
                TOCLayerModelJS.DisplayZoneBoundaryLayer();

                //// DISPLAY UC BOUNDARY ////
                TOCLayerModelJS.DisplayUCBoundaryLayer();

                //// THIS FUNCTION SHOW CONTAINER FEATURE ON MAP (CONDITION STATUS)
                ContainerModelJS.ShowContainerFeatureMapBaseStatus(feature_lists);

            }

            //// ONCHANGE FUNCTION THAT SHOW ZONE FROM THE SELECTED TOWN
            $("#cmd_town").change(function (e) {
                let selected_value = e.target.value;
                {#alert(selected_value);#}
                let condition_column = "zone_code=" + selected_value;
                let cmd_column = "zone_code^^zone_name";
                UtilityModelJS.FillCmdListByModelWithCode("tbl_zone_boundary", condition_column, cmd_column, "cmd_zone", "");
            });

            //// ONCHANGE FUNCTION THAT SHOW ZONE FROM THE SELECTED TOWN
            $("#cmd_zone").change(function (e) {
                let selected_value = e.target.value;
                {#alert(selected_value);#}
                let condition_column = "mc_code=" + selected_value;
                let cmd_column = "mc_code^^mc_name";
                UtilityModelJS.FillCmdListByModelWithCode("tbl_mc_boundary", condition_column, cmd_column, "cmd_mc", "");
            });

        }); //// DOCUMENT READY CLOSE

    </script>
{% endblock %}
<!-- End Custom JS -->