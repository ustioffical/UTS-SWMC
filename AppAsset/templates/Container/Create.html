{% extends "master.html" %}
{% load static %}

{% block title %}Container{% endblock %}

<!-- Custom Plugins CSS -->
{% block PluginsCSS %}
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/flatpickr/flatpickr.min.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/select.bootstrap5.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "assets/css/vendors/select/bootstrap-select.min.css" %}">
{% endblock %}
<!--End Custom Plugins CSS -->

{% block LeafletLink %}
    <!--Google Key-->
    {#    <script async defer#}
    {#            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDyN4NVgaHV6-AbuAdWqSBM07iay6gbfKc">#}
    {#    </script>#}
    <script type="text/javascript"
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDyN4NVgaHV6-AbuAdWqSBM07iay6gbfKc&libraries=places"></script>


    <!--leaflet js library style link -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
          integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
          crossorigin=""/>
    <link rel="stylesheet"
          href="{% static 'assets/script/jslib/leaflet/plugins/PolylineMeasure/Leaflet.PolylineMeasure.css' %}"/>
    <link rel="stylesheet"
          href="{% static 'assets/script/jslib/leaflet/plugins/styledLayerControl/styledLayerControl.css' %}"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"/>
{% endblock %}

{% block css %}

    .default-map-js-height{
    height: 605px;
    }

{% endblock %}

<!-- Header Page Hierarchy-->
{% block breadcrumb %}
    <div class="container-fluid">
        <div class="page-title">
            <div class="row">
                <div class="col-sm-6">
                    {#        <h3>{{breadcrumb.title}} </h3>#}
                    <h3>Add-on New Container</h3>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/index">
                            <svg class="stroke-icon">
                                <use href="{% static 'assets/svg/icon-sprite.svg' %}#stroke-home"></use>
                            </svg>
                        </a></li>
                        {#          <li class="breadcrumb-item">{{breadcrumb.parent}}</li>#}
                        <li class="breadcrumb-item">Asset</li>
                        <li class="breadcrumb-item">Container</li>
                        <li class="breadcrumb-item active">Create</li>
                        {#          <li class="breadcrumb-item active">{{breadcrumb.child}}</li>#}
                    </ol>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
<!-- Header Page Hierarchy-->

{% block content %}

    <!-- Container-fluid starts-->
    <div class="container-fluid main-tasks">

        <div class="row">
            <div class="col-xl-6">

                <form class="form form-horizontal" action="" method="post" accept-charset='utf-8'
                      enctype="multipart/form-data" id="ContainerForm">

                    {% csrf_token %}

                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title">Information</h5>
                        </div>
                        <div class="card-body">

                            <div id="info_message">
                                <div class="alert alert-bg-success light alert-dismissible fade hide txt-success border-left-success"
                                     role="alert">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                         fill="none"
                                         stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                         stroke-linejoin="round"
                                         class="feather feather-check-square">
                                        <polyline points="9 11 12 14 22 4"></polyline>
                                        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                                    </svg>
                                    <p>Success: New Container Added!!!</p>
                                    <button class="btn-close" type="button" data-bs-dismiss="alert"
                                            aria-label="Close"></button>
                                </div>
                            </div>

                            <div class="row custom-input">

                                <div class="col-sm-6 col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label" for="customFirstName">Container Name</label>
                                        {{ form.container_name }}
                                    </div>
                                </div>
                                <div class="col-sm-6 col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label" for="customLastName">Container Code</label>
                                        {{ form.container_code }}
                                    </div>
                                </div>

                                <div class="col-sm-6 col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Town Name</label>
                                        <select id="cmd_town" name="cmd_town" class="form-select">
                                            <option Value="NA">Choose One</option>
                                            {% for town in town_boundary %}
                                                <option value="{{ town.town_code }}">
                                                    {{ town.town_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="col-sm-6 col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Zone Name</label>
                                        <select class="form-select" id="cmd_zone" name="cmd_zone">
                                            <option value="NA">Select</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="col-sm-6 col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">MC Name</label>
                                        <select class="form-select" id="cmd_mc" name="cmd_mc">
                                            <option value="NA">Select</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-sm-6 col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label" for="customLastName">Area</label>
                                        {{ form.area }}
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="mb-3">
                                        <label class="form-label" for="customAddress">Address</label>
                                        {{ form.address }}
                                    </div>
                                </div>

                                <div class="col-sm-6 col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Size</label>
                                        {{ form.size }}
                                    </div>
                                </div>

                                <div class="col-sm-6 col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Install Year</label>
                                        <div class="input-group flatpicker-calender">
                                            <input class="form-control flatpickr-input active" id="install_year"
                                                   name="install_year" type="text"
                                                   placeholder="Enter a Valid Date" readonly="readonly">
                                        </div>
                                    </div>
                                </div>

                                <div class="col-sm-6 col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Working Status</label>
                                        {{ form.working_status }}
                                    </div>
                                </div>
                                <div class="col-sm-6 col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Status</label>
                                        {{ form.status }}
                                    </div>
                                </div>

                            </div>
                        </div>
                        <div class="card-footer text-end">
                            <button class="btn btn-primary" type="submit">Save Container</button>

                            <!-- STRING GENERATE FOR VIEW TO SAVING DATA -->
                            <input type="hidden" id="feature_coordinate" name="feature_coordinate" value="NA">
                            <input type="hidden" id="lattitude" name="lattitude" value="NA">
                            <input type="hidden" id="longitude" name="longitude" value="NA">

                        </div>
                    </div>

                </form>

            </div>
            <div class="col-xl-6">
                <div class="card">
                    <div class="card-header common-project-header common-space p-13">
                        <div class="common-space">
                            <div class="pe-sm-3">
                                <h5>Map</h5>
                            </div>
                        </div>
                        <div class="common-align">
                            <ul class="common-align">
                                <li>
                                    <svg>
                                        <i class="fa-solid fa-map-marker fa-fade txt-secondary"></i>
                                    </svg>
                                    <span>Coordinate :</span>
                                    <span id="show_coordinate"></span>
                                </li>
                            </ul>
                            <button id="add-marker-feature" class="btn btn-primary"><i
                                    class="fa-solid fa-plus"></i> Mark Location
                            </button>

                            {#                            <button id="add-marker-feature" type="button" class="btn btn-link toolbar_btn" rel="tooltip"#}
                            {#                                    data-placement="right" data-html="true"#}
                            {#                                    title="<b><p style='color: snow; padding-top: 2px;'>Marker</p></b>">#}
                            {#                                <img id="img-add-marker"#}
                            {#                                     src="{% static 'das/assets/images/toolbar-icon/marker.png' %}"/>#}
                            {#                            </button>#}

                        </div>
                        {#                        <h5 class="card-title">Map</h5>#}

                    </div>
                    <div class="card-body z-1 p-0">
                        <div class="default-map-js-height b-r-10" id="create-container-map"></div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <!-- Container-fluid Ends-->

{% endblock %}

<!-- Plugins JS start-->
{% block PluginsJS %}

    <script src="{% static "assets/js/flat-pickr/flatpickr.js" %}"></script>
    <script src="{% static "assets/js/flat-pickr/custom-flatpickr.js" %}"></script>
    <script src="{% static "assets/js/form-validation-custom.js" %}"></script>
    <script src="{% static "assets/js/select/bootstrap-select.min.js" %}"></script>

{% endblock %}
<!-- Plugins JS Ends-->

{% block LeafletJS %}
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
            integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
            crossorigin=""></script>
    <script src="{% static 'assets/script/jslib/leaflet/plugins/GoogleMutant/Leaflet.GoogleMutant.js' %}"></script>
    <script src="{% static 'assets/script/jslib/leaflet/plugins/measure/L.MeasuringTool.js' %}"></script>
    <script src="{% static 'assets/script/jslib/leaflet/plugins/PolylineMeasure/Leaflet.PolylineMeasure.js' %}"></script>
    <script src="{% static 'assets/script/jslib/leaflet/plugins/styledLayerControl/styledLayerControl.js' %}"></script>
    <!-- Dependency to Leaflet Draw -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <script src="https://npmcdn.com/leaflet.path.drag/src/Path.Drag.js"></script>
    <script src="{% static "assets/script/jslib/leaflet/plugins/Editable/Leaflet.Editable.js" %}"></script>
    <script src="{% static "assets/script/jslib/leaflet/plugins/Snap/leaflet.geometryutil.js" %}"></script>
    <script src="{% static "assets/script/jslib/leaflet/plugins/Snap/leaflet.snap.js" %}"></script>

    <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>

{% endblock %}

<!-- Custom JS -->
{% block CustomerJS %}
    <script src="{% static "assets/script/include/DigitalArz.js" %}" type="text/javascript"></script>
    <script src="{% static "assets/script/include/TOCLayerModel.js" %}" type="text/javascript"></script>
    <script>

        let DigitalArzModelJS = null;
        let TOCLayerModelJS = null;

        $("#id_container_code").val('{{ auto_container_code | safe }}');

        $(document).ready(function () {


            //// MAPPING MODEL JS
            DigitalArzModelJS = new AppDigitalArzModel("create-container-map");
            if (DigitalArzModelJS.map === null) {
                DigitalArzModelJS.LoadMap("true", "");
                {#var district_extent = '72.29040124100004,31.214599082000063,72.40054018600006,31.319403121000054';#}
                {#////  THIS FUNCTION IS USED TO ZOOM THE LAYER  /////#}
                {#PMDFCModelJS.ZoomToFeature(district_extent);#}

                //// TOC LAYER MODEL LAYER DEFINE
                TOCLayerModelJS = new AppTOCLayerModel();
                TOCLayerModelJS.appConstructor();

                //// DISPLAY TOWN BOUNDARY ////
                TOCLayerModelJS.DisplayTownBoundaryLayer();

                //// DISPLAY ZONE BOUNDARY ////
                TOCLayerModelJS.DisplayZoneBoundaryLayer();

                //// DISPLAY UC BOUNDARY ////
                TOCLayerModelJS.DisplayUCBoundaryLayer();

            }

            //// ONCHANGE FUNCTION THAT SHOW ZONE FROM THE SELECTED TOWN
            $("#cmd_town").change(function (e) {
                let selected_value = e.target.value;
                {#alert(selected_value);#}
                let condition_column = "zone_code=" + selected_value;
                let cmd_column = "zone_code^^zone_name";
                UtilityModelJS.FillCmdListByModelWithCode("tbl_zone_boundary", condition_column, cmd_column, "cmd_zone", "");
            });

            //// ONCHANGE FUNCTION THAT SHOW ZONE FROM THE SELECTED TOWN
            $("#cmd_zone").change(function (e) {
                let selected_value = e.target.value;
                {#alert(selected_value);#}
                let condition_column = "mc_code=" + selected_value;
                let cmd_column = "mc_code^^mc_name";
                UtilityModelJS.FillCmdListByModelWithCode("tbl_mc_boundary", condition_column, cmd_column, "cmd_mc", "");
            });

        }); //// DOCUMENT READY CLOSE

        // Date Picker
        flatpickr("#install_year", {});

        let message = '{{ message }}';
        ////SUCCESS MESSAGE
        if (message === "Success") {
            $('.alert').addClass('show');
            $('.alert').removeClass('hide');
            setTimeout(function () {
                $('.alert').removeClass('show');
                $('.alert').addClass('hide');
            }, 5000);
        }


    </script>
{% endblock %}
<!-- End Custom JS -->